import{d as ee,u as se,r as v,k as te,l as W,m as le,n as x,c as o,o as i,a as e,b as a,t as u,p as y,F as D,q as A,s as f,f as $,w as T,e as B,v as V,_ as oe}from"./index-BQ6vs-L1.js";const ie={class:"dashboard"},ne={class:"sidebar-header"},ae={key:0,class:"logo-text"},re={class:"sidebar-nav"},de={class:"nav-section"},ue={key:0,class:"nav-title"},ve={key:0,class:"nav-text"},ce={class:"nav-section"},me={key:0,class:"nav-title"},pe=["onClick"],fe=["src","alt"],ge={key:0,class:"nav-text"},ye={class:"sidebar-footer"},be={class:"user-profile"},he=["src","alt"],ke={key:0,class:"user-details"},we={key:0,class:"nav-text"},_e={class:"main-content"},Ce={class:"content-header"},We={class:"header-left"},Ie={class:"header-info"},Ee={class:"welcome-text"},xe={class:"content-area"},$e={class:"stats-cards"},Se={class:"stat-card"},Me={class:"stat-info"},De={class:"stat-card"},Be={class:"stat-info"},Ve={class:"stat-card"},Ue={class:"stat-info"},Ae={class:"wishes-section"},Te={class:"section-header"},Le={class:"view-controls"},Ne={class:"wish-image-container"},ze=["src","alt"],Oe={class:"wish-actions"},Re={key:0,class:"reserved-badge",title:"Это желание уже зарезервировано другим пользователем"},qe=["onClick"],Fe=["onClick"],je=["onClick"],Ge={class:"wish-content"},He={class:"wish-title"},Je={class:"wish-description"},Ke={class:"wish-tags"},Pe={key:0,class:"reserve-info"},Qe={class:"wish-footer"},Xe=["href"],Ye={key:0,class:"empty-state"},Ze={key:0},es={key:1},ss={class:"modal"},ts={class:"modal-header"},ls={class:"modal-body"},os={class:"form-group"},is={class:"form-group"},ns={class:"form-group"},as={class:"form-group"},rs={class:"modal-footer"},ds=["disabled"],us={class:"modal confirm-modal"},vs={class:"modal-header"},cs={class:"modal-body"},ms={class:"modal-footer"},ps={class:"modal confirm-modal"},fs={class:"modal-header"},gs={class:"modal-body"},ys={class:"modal-footer"},bs=ee({__name:"DashboardView",setup(hs){const r=se(),c=v(!1),g=v(!1),I=v(!1),m=v("my-wishes"),b=v("grid"),S=v(!1),h=v(!1),k=v(!1),w=v(!1),d=v([]),M=v([]),_=v(null),C=v(null),n=v({id:"",title:"",description:"",link:"",image:"",tagsInput:""}),U=()=>{I.value=window.innerWidth<768};te(async()=>{U(),window.addEventListener("resize",U);try{d.value=await W.getWishes();const l=await W.getUsers();M.value=l.filter(s=>s.id!==r.user?.id)}catch(l){console.error("Ошибка загрузки данных:",l)}}),le(()=>{window.removeEventListener("resize",U)});const L=x(()=>{if(m.value==="my-wishes")return d.value.filter(l=>l.userId===r.user?.id);if(m.value.startsWith("user-")){const l=m.value.split("-")[1];return d.value.filter(s=>s.userId===l)}return d.value}),R=x(()=>d.value.filter(l=>l.userId===r.user?.id).length),q=x(()=>d.value.filter(l=>l.userId!==r.user?.id).length),F=x(()=>{if(m.value==="my-wishes")return`Добро пожаловать, ${r.user?.username}!`;{const l=M.value.find(s=>`user-${s.id}`===m.value);return l?`Вишлист ${l.username}`:"Вишлист"}}),j=x(()=>m.value==="my-wishes"?"Управляйте своими желаниями":"Просматривайте желания других пользователей"),G=()=>{I.value?g.value=!g.value:c.value=!c.value},H=()=>{g.value=!g.value},N=()=>{g.value=!1},z=l=>{m.value=l,I.value&&N()},O=()=>{w.value=!1,n.value={id:"",title:"",description:"",link:"",image:"",tagsInput:""},S.value=!0},J=l=>{w.value=!0,n.value={id:l.id,title:l.title,description:l.description||"",link:l.link||"",image:l.image||"",tagsInput:Array.isArray(l.tags)?l.tags.join(", "):""},S.value=!0},E=()=>{S.value=!1,w.value=!1},K=async()=>{if(n.value.title.trim())try{const l={title:n.value.title,description:n.value.description,link:n.value.link,image:n.value.image,tags:n.value.tagsInput?n.value.tagsInput.split(",").map(t=>t.trim()).filter(Boolean):[],userId:r.user?.id||"",createdAt:new Date().toISOString(),reservedBy:null},s=await W.createWish(l);d.value.unshift(s),E(),window.dispatchEvent(new CustomEvent("show-notification",{detail:{message:"Желание успешно добавлено!",type:"success",duration:3e3}}))}catch(l){console.error("Ошибка при добавлении желания:",l),window.dispatchEvent(new CustomEvent("show-notification",{detail:{message:l.message||"Ошибка при добавлении желания",type:"error",duration:4e3}}))}},P=async()=>{if(n.value.title.trim())try{const l={title:n.value.title,description:n.value.description,link:n.value.link,image:n.value.image,tags:n.value.tagsInput?n.value.tagsInput.split(",").map(p=>p.trim()).filter(Boolean):[]},s=await W.updateWish(n.value.id,l),t=d.value.findIndex(p=>p.id===n.value.id);t!==-1&&(d.value[t]={...d.value[t],...s}),E(),window.dispatchEvent(new CustomEvent("show-notification",{detail:{message:"Желание успешно обновлено!",type:"success",duration:3e3}}))}catch(l){console.error("Ошибка при обновлении желания:",l),window.dispatchEvent(new CustomEvent("show-notification",{detail:{message:l.message||"Ошибка при обновлении желания",type:"error",duration:4e3}}))}},Q=l=>{_.value=l,h.value=!0},X=async()=>{if(_.value)try{await W.deleteWish(_.value.id),d.value=d.value.filter(l=>l.id!==_.value.id),h.value=!1,_.value=null,window.dispatchEvent(new CustomEvent("show-notification",{detail:{message:"Желание успешно удалено",type:"success",duration:3e3}}))}catch(l){console.error("Ошибка при удалении желания:",l),window.dispatchEvent(new CustomEvent("show-notification",{detail:{message:l.message||"Ошибка при удалении желания",type:"error",duration:4e3}}))}},Y=l=>{C.value=l,k.value=!0},Z=async()=>{if(C.value)try{const l={reservedBy:r.user?.id,reservedAt:new Date().toISOString()},s=await W.updateWish(C.value.id,l),t=d.value.findIndex(p=>p.id===C.value.id);t!==-1&&(d.value[t]={...d.value[t],...s}),k.value=!1,C.value=null,window.dispatchEvent(new CustomEvent("show-notification",{detail:{message:"Подарок успешно забронирован!",type:"success",duration:3e3}}))}catch(l){console.error("Ошибка при бронировании подарка:",l),window.dispatchEvent(new CustomEvent("show-notification",{detail:{message:l.message||"Ошибка при бронировании подарка",type:"error",duration:4e3}}))}};return(l,s)=>(i(),o("div",ie,[e("aside",{class:y(["sidebar",{"sidebar-collapsed":c.value,"sidebar-mobile-open":g.value}])},[e("div",ne,[e("div",{class:"logo",onClick:s[0]||(s[0]=t=>c.value=!c.value)},[s[16]||(s[16]=e("div",{class:"logo-icon"},"✨",-1)),c.value?a("",!0):(i(),o("span",ae,"WishLister"))]),e("button",{class:"toggle-btn",onClick:G},u(c.value?"→":"←"),1)]),e("nav",re,[e("div",de,[c.value?a("",!0):(i(),o("h3",ue,"Мой вишлист")),e("button",{class:y(["nav-item",{active:m.value==="my-wishes"}]),onClick:s[1]||(s[1]=t=>z("my-wishes"))},[s[17]||(s[17]=e("span",{class:"nav-icon"},"📦",-1)),c.value?a("",!0):(i(),o("span",ve,"Мои желания"))],2)]),e("div",ce,[c.value?a("",!0):(i(),o("h3",me,"Другие пользователи")),(i(!0),o(D,null,A(M.value,t=>(i(),o("button",{key:t.id,class:y(["nav-item",{active:m.value===`user-${t.id}`}]),onClick:p=>z(`user-${t.id}`)},[e("img",{src:t.avatar,alt:t.username,class:"user-avatar-small"},null,8,fe),c.value?a("",!0):(i(),o("span",ge,u(t.username),1))],10,pe))),128))])]),e("div",ye,[e("div",be,[e("img",{src:f(r).user?.avatar,alt:f(r).user?.username,class:"user-avatar"},null,8,he),c.value?a("",!0):(i(),o("div",ke,[e("strong",null,u(f(r).user?.username),1),s[18]||(s[18]=e("span",null,"Ваш профиль",-1))]))]),e("button",{class:"nav-item logout-btn",onClick:s[2]||(s[2]=(...t)=>f(r).logout&&f(r).logout(...t))},[s[19]||(s[19]=e("span",{class:"nav-icon"},"🚪",-1)),c.value?a("",!0):(i(),o("span",we,"Выйти"))])])],2),I.value&&g.value?(i(),o("div",{key:0,class:"sidebar-overlay",onClick:N})):a("",!0),e("main",_e,[e("header",Ce,[e("div",We,[I.value?(i(),o("button",{key:0,class:"menu-toggle",onClick:H},[...s[20]||(s[20]=[e("span",{class:"menu-icon"},"☰",-1)])])):a("",!0),e("div",Ie,[e("h1",null,u(F.value),1),e("p",Ee,u(j.value),1)])]),m.value==="my-wishes"?(i(),o("button",{key:0,class:"add-wish-btn",onClick:O},[...s[21]||(s[21]=[e("span",{class:"btn-icon"},"➕",-1),$(" Добавить желание ",-1)])])):a("",!0)]),e("div",xe,[e("div",$e,[e("div",Se,[s[23]||(s[23]=e("div",{class:"stat-icon"},"📝",-1)),e("div",Me,[e("h3",null,u(R.value),1),s[22]||(s[22]=e("p",null,"Мои желания",-1))])]),e("div",De,[s[25]||(s[25]=e("div",{class:"stat-icon"},"👀",-1)),e("div",Be,[e("h3",null,u(q.value),1),s[24]||(s[24]=e("p",null,"Чужие желания",-1))])]),e("div",Ve,[s[27]||(s[27]=e("div",{class:"stat-icon"},"👥",-1)),e("div",Ue,[e("h3",null,u(M.value.length),1),s[26]||(s[26]=e("p",null,"Пользователи",-1))])])]),e("div",Ae,[e("div",Te,[s[28]||(s[28]=e("h2",null,"Список желаний",-1)),e("div",Le,[e("button",{class:y(["view-btn",{active:b.value==="grid"}]),onClick:s[3]||(s[3]=t=>b.value="grid")}," ◼️ Сетка ",2),e("button",{class:y(["view-btn",{active:b.value==="list"}]),onClick:s[4]||(s[4]=t=>b.value="list")}," 📋 Список ",2)])]),e("div",{class:y(["wishes-container",b.value])},[(i(!0),o(D,null,A(L.value,t=>(i(),o("div",{key:t.id,class:y(["wish-card",b.value,{reserved:t.reservedBy&&t.userId!==f(r).user?.id}])},[e("div",Ne,[e("img",{src:t.image,alt:t.title,class:"wish-image"},null,8,ze),e("div",Oe,[t.reservedBy&&t.userId!==f(r).user?.id?(i(),o("div",Re," 🎁 Забронировано ")):a("",!0),t.userId!==f(r).user?.id&&!t.reservedBy?(i(),o("button",{key:1,class:"reserve-btn",onClick:p=>Y(t),title:"Забронировать этот подарок"}," 🎁 Забронировать ",8,qe)):a("",!0),t.userId===f(r).user?.id?(i(),o(D,{key:2},[e("button",{class:"edit-btn",onClick:p=>J(t),title:"Редактировать желание"}," ✏️ ",8,Fe),e("button",{class:"delete-btn",onClick:p=>Q(t),title:"Удалить желание"}," 🗑️ ",8,je)],64)):a("",!0)])]),e("div",Ge,[e("h3",He,u(t.title),1),e("p",Je,u(t.description),1),e("div",Ke,[(i(!0),o(D,null,A(t.tags,p=>(i(),o("span",{key:p,class:"tag"},u(p),1))),128))]),t.reservedBy&&t.userId===f(r).user?.id?(i(),o("div",Pe,[...s[29]||(s[29]=[e("div",{class:"reserve-notice"}," 🎁 Кто-то собирается подарить вам это! ",-1)])])):a("",!0),e("div",Qe,[t.link?(i(),o("a",{key:0,href:t.link,target:"_blank",class:"wish-link"}," 🔗 Перейти ",8,Xe)):a("",!0)])])],2))),128)),L.value.length===0?(i(),o("div",Ye,[s[30]||(s[30]=e("div",{class:"empty-icon"},"📝",-1)),s[31]||(s[31]=e("h3",null,"Пока нет желаний",-1)),m.value==="my-wishes"?(i(),o("p",Ze,"Добавьте первое желание, нажав на кнопку")):(i(),o("p",es,"У этого пользователя пока нет желаний")),m.value==="my-wishes"?(i(),o("button",{key:2,class:"empty-btn",onClick:O}," Добавить желание ")):a("",!0)])):a("",!0)],2)])])]),S.value?(i(),o("div",{key:1,class:"modal-overlay",onClick:T(E,["self"])},[e("div",ss,[e("div",ts,[e("h2",null,u(w.value?"Редактировать желание":"Добавить новое желание"),1),e("button",{class:"modal-close",onClick:E},"×")]),e("div",ls,[e("div",os,[s[32]||(s[32]=e("label",null,"Название желания *",-1)),B(e("input",{"onUpdate:modelValue":s[5]||(s[5]=t=>n.value.title=t),type:"text",placeholder:"Например, кружка эээ",required:""},null,512),[[V,n.value.title]])]),e("div",is,[s[33]||(s[33]=e("label",null,"Описание",-1)),B(e("textarea",{"onUpdate:modelValue":s[6]||(s[6]=t=>n.value.description=t),placeholder:"Расскажите подробнее о вашем желании...",rows:"3"},null,512),[[V,n.value.description]])]),e("div",ns,[s[34]||(s[34]=e("label",null,"Ссылка на товар (необязательно)",-1)),B(e("input",{"onUpdate:modelValue":s[7]||(s[7]=t=>n.value.link=t),type:"url",placeholder:"https://example.com"},null,512),[[V,n.value.link]])]),e("div",as,[s[35]||(s[35]=e("label",null,"Ссылка на фото (необязательно)",-1)),B(e("input",{"onUpdate:modelValue":s[8]||(s[8]=t=>n.value.image=t),type:"url",placeholder:"https://example.com"},null,512),[[V,n.value.image]])])]),e("div",rs,[e("button",{class:"btn-secondary",onClick:E},"Отмена"),e("button",{class:"btn-primary",onClick:s[9]||(s[9]=t=>w.value?P():K()),disabled:!n.value.title.trim()},u(w.value?"Сохранить":"Добавить"),9,ds)])])])):a("",!0),h.value?(i(),o("div",{key:2,class:"modal-overlay",onClick:s[12]||(s[12]=T(t=>h.value=!1,["self"]))},[e("div",us,[e("div",vs,[s[36]||(s[36]=e("h2",null,"Подтверждение удаления",-1)),e("button",{class:"modal-close",onClick:s[10]||(s[10]=t=>h.value=!1)},"×")]),e("div",cs,[e("p",null,[s[37]||(s[37]=$('Вы уверены, что хотите удалить желание "',-1)),e("strong",null,u(_.value?.title),1),s[38]||(s[38]=$('"?',-1))]),s[39]||(s[39]=e("p",{class:"warning-text"},"Это действие нельзя отменить!",-1))]),e("div",ms,[e("button",{class:"btn-secondary",onClick:s[11]||(s[11]=t=>h.value=!1)},"Отмена"),e("button",{class:"btn-danger",onClick:X},"Удалить")])])])):a("",!0),k.value?(i(),o("div",{key:3,class:"modal-overlay",onClick:s[15]||(s[15]=T(t=>k.value=!1,["self"]))},[e("div",ps,[e("div",fs,[s[40]||(s[40]=e("h2",null,"Бронирование подарка",-1)),e("button",{class:"modal-close",onClick:s[13]||(s[13]=t=>k.value=!1)},"×")]),e("div",gs,[e("p",null,[s[41]||(s[41]=$('Вы собираетесь забронировать подарок "',-1)),e("strong",null,u(C.value?.title),1),s[42]||(s[42]=$('"?',-1))]),s[43]||(s[43]=e("p",{class:"info-text"},"Другие пользователи увидят, что этот подарок уже забронирован, но автор желания не узнает, кто именно его забронировал.",-1))]),e("div",ys,[e("button",{class:"btn-secondary",onClick:s[14]||(s[14]=t=>k.value=!1)},"Отмена"),e("button",{class:"btn-primary",onClick:Z},"Забронировать")])])])):a("",!0)]))}}),ws=oe(bs,[["__scopeId","data-v-4fbcf7cb"]]);export{ws as default};
