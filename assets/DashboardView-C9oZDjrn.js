import{d as te,u as le,r as v,k as oe,l as W,m as ie,n as $,c as o,o as i,a as e,b as a,t as d,p as h,F as M,q as A,s as f,f as D,w as T,e as B,v as U,_ as ne}from"./index-CvZ4XLDC.js";const ae={class:"dashboard"},re={class:"sidebar-header"},de={key:0,class:"logo-text"},ue={class:"sidebar-nav"},ve={class:"nav-section"},ce={key:0,class:"nav-title"},me={key:0,class:"nav-text"},pe={class:"nav-section"},fe={key:0,class:"nav-title"},ge=["onClick"],he=["src","alt"],ye={key:0,class:"nav-text"},be={class:"sidebar-footer"},ke={class:"user-profile"},we=["src","alt"],_e={key:0,class:"user-details"},Ce={key:0,class:"nav-text"},We={class:"main-content"},Ie={class:"content-header"},Ee={class:"header-left"},xe={class:"header-info"},$e={class:"welcome-text"},De={class:"content-area"},Se={class:"stats-cards"},Me={class:"stat-card"},Be={class:"stat-info"},Ue={class:"stat-card"},Ve={class:"stat-info"},Ae={class:"stat-card"},Te={class:"stat-info"},Le={class:"wishes-section"},Ne={class:"section-header"},Re={class:"view-controls"},ze={class:"wish-image-container"},Oe=["src","alt"],qe={class:"wish-actions"},Fe={key:0,class:"reserved-badge",title:"Это желание уже зарезервировано другим пользователем"},je=["onClick"],Ge=["onClick"],He=["onClick"],Je={class:"wish-content"},Ke={class:"wish-title"},Pe={class:"wish-description"},Qe={class:"wish-tags"},Xe={key:0,class:"reserve-info"},Ye={class:"wish-footer"},Ze=["href"],es={class:"wish-meta"},ss={class:"wish-date"},ts={class:"wish-author"},ls={key:0,class:"empty-state"},os={key:0},is={key:1},ns={class:"modal"},as={class:"modal-header"},rs={class:"modal-body"},ds={class:"form-group"},us={class:"form-group"},vs={class:"form-group"},cs={class:"form-group"},ms={class:"modal-footer"},ps=["disabled"],fs={class:"modal confirm-modal"},gs={class:"modal-header"},hs={class:"modal-body"},ys={class:"modal-footer"},bs={class:"modal confirm-modal"},ks={class:"modal-header"},ws={class:"modal-body"},_s={class:"modal-footer"},Cs=te({__name:"DashboardView",setup(Ws){const r=le(),c=v(!1),g=v(!1),I=v(!1),m=v("my-wishes"),y=v("grid"),S=v(!1),b=v(!1),k=v(!1),w=v(!1),u=v([]),E=v([]),_=v(null),C=v(null),n=v({id:"",title:"",description:"",link:"",image:"",tagsInput:""}),V=()=>{I.value=window.innerWidth<768};oe(async()=>{V(),window.addEventListener("resize",V);try{u.value=await W.getWishes();const l=await W.getUsers();E.value=l.filter(s=>s.id!==r.user?.id)}catch(l){console.error("Ошибка загрузки данных:",l)}}),ie(()=>{window.removeEventListener("resize",V)});const L=$(()=>{if(m.value==="my-wishes")return u.value.filter(l=>l.userId===r.user?.id);if(m.value.startsWith("user-")){const l=m.value.split("-")[1];return u.value.filter(s=>s.userId===l)}return u.value}),O=$(()=>u.value.filter(l=>l.userId===r.user?.id).length),q=$(()=>u.value.filter(l=>l.userId!==r.user?.id).length),F=$(()=>{if(m.value==="my-wishes")return`Добро пожаловать, ${r.user?.username}!`;{const l=E.value.find(s=>`user-${s.id}`===m.value);return l?`Вишлист ${l.username}`:"Вишлист"}}),j=$(()=>m.value==="my-wishes"?"Управляйте своими желаниями":"Просматривайте желания других пользователей"),G=()=>{I.value?g.value=!g.value:c.value=!c.value},H=()=>{g.value=!g.value},N=()=>{g.value=!1},R=l=>{m.value=l,I.value&&N()},J=l=>new Date(l).toLocaleDateString("ru-RU"),K=l=>{if(l===r.user?.id)return"Вы";const s=E.value.find(t=>t.id===l);return s?s.username:"Неизвестный"},z=()=>{w.value=!1,n.value={id:"",title:"",description:"",link:"",image:"",tagsInput:""},S.value=!0},P=l=>{w.value=!0,n.value={id:l.id,title:l.title,description:l.description||"",link:l.link||"",image:l.image||"",tagsInput:Array.isArray(l.tags)?l.tags.join(", "):""},S.value=!0},x=()=>{S.value=!1,w.value=!1},Q=async()=>{if(n.value.title.trim())try{const l={title:n.value.title,description:n.value.description,link:n.value.link,image:n.value.image,tags:n.value.tagsInput?n.value.tagsInput.split(",").map(t=>t.trim()).filter(Boolean):[],userId:r.user?.id||"",createdAt:new Date().toISOString(),reservedBy:null},s=await W.createWish(l);u.value.unshift(s),x(),window.dispatchEvent(new CustomEvent("show-notification",{detail:{message:"Желание успешно добавлено!",type:"success",duration:3e3}}))}catch(l){console.error("Ошибка при добавлении желания:",l),window.dispatchEvent(new CustomEvent("show-notification",{detail:{message:l.message||"Ошибка при добавлении желания",type:"error",duration:4e3}}))}},X=async()=>{if(n.value.title.trim())try{const l={title:n.value.title,description:n.value.description,link:n.value.link,image:n.value.image,tags:n.value.tagsInput?n.value.tagsInput.split(",").map(p=>p.trim()).filter(Boolean):[]},s=await W.updateWish(n.value.id,l),t=u.value.findIndex(p=>p.id===n.value.id);t!==-1&&(u.value[t]={...u.value[t],...s}),x(),window.dispatchEvent(new CustomEvent("show-notification",{detail:{message:"Желание успешно обновлено!",type:"success",duration:3e3}}))}catch(l){console.error("Ошибка при обновлении желания:",l),window.dispatchEvent(new CustomEvent("show-notification",{detail:{message:l.message||"Ошибка при обновлении желания",type:"error",duration:4e3}}))}},Y=l=>{_.value=l,b.value=!0},Z=async()=>{if(_.value)try{await W.deleteWish(_.value.id),u.value=u.value.filter(l=>l.id!==_.value.id),b.value=!1,_.value=null,window.dispatchEvent(new CustomEvent("show-notification",{detail:{message:"Желание успешно удалено",type:"success",duration:3e3}}))}catch(l){console.error("Ошибка при удалении желания:",l),window.dispatchEvent(new CustomEvent("show-notification",{detail:{message:l.message||"Ошибка при удалении желания",type:"error",duration:4e3}}))}},ee=l=>{C.value=l,k.value=!0},se=async()=>{if(C.value)try{const l={reservedBy:r.user?.id,reservedAt:new Date().toISOString()},s=await W.updateWish(C.value.id,l),t=u.value.findIndex(p=>p.id===C.value.id);t!==-1&&(u.value[t]={...u.value[t],...s}),k.value=!1,C.value=null,window.dispatchEvent(new CustomEvent("show-notification",{detail:{message:"Подарок успешно забронирован!",type:"success",duration:3e3}}))}catch(l){console.error("Ошибка при бронировании подарка:",l),window.dispatchEvent(new CustomEvent("show-notification",{detail:{message:l.message||"Ошибка при бронировании подарка",type:"error",duration:4e3}}))}};return(l,s)=>(i(),o("div",ae,[e("aside",{class:h(["sidebar",{"sidebar-collapsed":c.value,"sidebar-mobile-open":g.value}])},[e("div",re,[e("div",{class:"logo",onClick:s[0]||(s[0]=t=>c.value=!c.value)},[s[16]||(s[16]=e("div",{class:"logo-icon"},"✨",-1)),c.value?a("",!0):(i(),o("span",de,"WishLister"))]),e("button",{class:"toggle-btn",onClick:G},d(c.value?"→":"←"),1)]),e("nav",ue,[e("div",ve,[c.value?a("",!0):(i(),o("h3",ce,"Мой вишлист")),e("button",{class:h(["nav-item",{active:m.value==="my-wishes"}]),onClick:s[1]||(s[1]=t=>R("my-wishes"))},[s[17]||(s[17]=e("span",{class:"nav-icon"},"📦",-1)),c.value?a("",!0):(i(),o("span",me,"Мои желания"))],2)]),e("div",pe,[c.value?a("",!0):(i(),o("h3",fe,"Другие пользователи")),(i(!0),o(M,null,A(E.value,t=>(i(),o("button",{key:t.id,class:h(["nav-item",{active:m.value===`user-${t.id}`}]),onClick:p=>R(`user-${t.id}`)},[e("img",{src:t.avatar,alt:t.username,class:"user-avatar-small"},null,8,he),c.value?a("",!0):(i(),o("span",ye,d(t.username),1))],10,ge))),128))])]),e("div",be,[e("div",ke,[e("img",{src:f(r).user?.avatar,alt:f(r).user?.username,class:"user-avatar"},null,8,we),c.value?a("",!0):(i(),o("div",_e,[e("strong",null,d(f(r).user?.username),1),s[18]||(s[18]=e("span",null,"Ваш профиль",-1))]))]),e("button",{class:"nav-item logout-btn",onClick:s[2]||(s[2]=(...t)=>f(r).logout&&f(r).logout(...t))},[s[19]||(s[19]=e("span",{class:"nav-icon"},"🚪",-1)),c.value?a("",!0):(i(),o("span",Ce,"Выйти"))])])],2),I.value&&g.value?(i(),o("div",{key:0,class:"sidebar-overlay",onClick:N})):a("",!0),e("main",We,[e("header",Ie,[e("div",Ee,[I.value?(i(),o("button",{key:0,class:"menu-toggle",onClick:H},[...s[20]||(s[20]=[e("span",{class:"menu-icon"},"☰",-1)])])):a("",!0),e("div",xe,[e("h1",null,d(F.value),1),e("p",$e,d(j.value),1)])]),m.value==="my-wishes"?(i(),o("button",{key:0,class:"add-wish-btn",onClick:z},[...s[21]||(s[21]=[e("span",{class:"btn-icon"},"➕",-1),D(" Добавить желание ",-1)])])):a("",!0)]),e("div",De,[e("div",Se,[e("div",Me,[s[23]||(s[23]=e("div",{class:"stat-icon"},"📝",-1)),e("div",Be,[e("h3",null,d(O.value),1),s[22]||(s[22]=e("p",null,"Мои желания",-1))])]),e("div",Ue,[s[25]||(s[25]=e("div",{class:"stat-icon"},"👀",-1)),e("div",Ve,[e("h3",null,d(q.value),1),s[24]||(s[24]=e("p",null,"Чужие желания",-1))])]),e("div",Ae,[s[27]||(s[27]=e("div",{class:"stat-icon"},"👥",-1)),e("div",Te,[e("h3",null,d(E.value.length),1),s[26]||(s[26]=e("p",null,"Пользователи",-1))])])]),e("div",Le,[e("div",Ne,[s[28]||(s[28]=e("h2",null,"Список желаний",-1)),e("div",Re,[e("button",{class:h(["view-btn",{active:y.value==="grid"}]),onClick:s[3]||(s[3]=t=>y.value="grid")}," ◼️ Сетка ",2),e("button",{class:h(["view-btn",{active:y.value==="list"}]),onClick:s[4]||(s[4]=t=>y.value="list")}," 📋 Список ",2)])]),e("div",{class:h(["wishes-container",y.value])},[(i(!0),o(M,null,A(L.value,t=>(i(),o("div",{key:t.id,class:h(["wish-card",y.value,{reserved:t.reservedBy&&t.userId!==f(r).user?.id}])},[e("div",ze,[e("img",{src:t.image,alt:t.title,class:"wish-image"},null,8,Oe),e("div",qe,[t.reservedBy&&t.userId!==f(r).user?.id?(i(),o("div",Fe," 🎁 Забронировано ")):a("",!0),t.userId!==f(r).user?.id&&!t.reservedBy?(i(),o("button",{key:1,class:"reserve-btn",onClick:p=>ee(t),title:"Забронировать этот подарок"}," 🎁 Забронировать ",8,je)):a("",!0),t.userId===f(r).user?.id?(i(),o(M,{key:2},[e("button",{class:"edit-btn",onClick:p=>P(t),title:"Редактировать желание"}," ✏️ ",8,Ge),e("button",{class:"delete-btn",onClick:p=>Y(t),title:"Удалить желание"}," 🗑️ ",8,He)],64)):a("",!0)])]),e("div",Je,[e("h3",Ke,d(t.title),1),e("p",Pe,d(t.description),1),e("div",Qe,[(i(!0),o(M,null,A(t.tags,p=>(i(),o("span",{key:p,class:"tag"},d(p),1))),128))]),t.reservedBy&&t.userId===f(r).user?.id?(i(),o("div",Xe,[...s[29]||(s[29]=[e("div",{class:"reserve-notice"}," 🎁 Кто-то собирается подарить вам это! ",-1)])])):a("",!0),e("div",Ye,[t.link?(i(),o("a",{key:0,href:t.link,target:"_blank",class:"wish-link"}," 🔗 Перейти ",8,Ze)):a("",!0),e("div",es,[e("span",ss,d(J(t.createdAt)),1),e("span",ts,d(K(t.userId)),1)])])])],2))),128)),L.value.length===0?(i(),o("div",ls,[s[30]||(s[30]=e("div",{class:"empty-icon"},"📝",-1)),s[31]||(s[31]=e("h3",null,"Пока нет желаний",-1)),m.value==="my-wishes"?(i(),o("p",os,"Добавьте первое желание, нажав на кнопку")):(i(),o("p",is,"У этого пользователя пока нет желаний")),m.value==="my-wishes"?(i(),o("button",{key:2,class:"empty-btn",onClick:z}," Добавить желание ")):a("",!0)])):a("",!0)],2)])])]),S.value?(i(),o("div",{key:1,class:"modal-overlay",onClick:T(x,["self"])},[e("div",ns,[e("div",as,[e("h2",null,d(w.value?"Редактировать желание":"Добавить новое желание"),1),e("button",{class:"modal-close",onClick:x},"×")]),e("div",rs,[e("div",ds,[s[32]||(s[32]=e("label",null,"Название желания *",-1)),B(e("input",{"onUpdate:modelValue":s[5]||(s[5]=t=>n.value.title=t),type:"text",placeholder:"Например, кружка эээ",required:""},null,512),[[U,n.value.title]])]),e("div",us,[s[33]||(s[33]=e("label",null,"Описание",-1)),B(e("textarea",{"onUpdate:modelValue":s[6]||(s[6]=t=>n.value.description=t),placeholder:"Расскажите подробнее о вашем желании...",rows:"3"},null,512),[[U,n.value.description]])]),e("div",vs,[s[34]||(s[34]=e("label",null,"Ссылка на товар (необязательно)",-1)),B(e("input",{"onUpdate:modelValue":s[7]||(s[7]=t=>n.value.link=t),type:"url",placeholder:"https://example.com"},null,512),[[U,n.value.link]])]),e("div",cs,[s[35]||(s[35]=e("label",null,"Ссылка на фото (необязательно)",-1)),B(e("input",{"onUpdate:modelValue":s[8]||(s[8]=t=>n.value.image=t),type:"url",placeholder:"https://example.com"},null,512),[[U,n.value.image]])])]),e("div",ms,[e("button",{class:"btn-secondary",onClick:x},"Отмена"),e("button",{class:"btn-primary",onClick:s[9]||(s[9]=t=>w.value?X():Q()),disabled:!n.value.title.trim()},d(w.value?"Сохранить":"Добавить"),9,ps)])])])):a("",!0),b.value?(i(),o("div",{key:2,class:"modal-overlay",onClick:s[12]||(s[12]=T(t=>b.value=!1,["self"]))},[e("div",fs,[e("div",gs,[s[36]||(s[36]=e("h2",null,"Подтверждение удаления",-1)),e("button",{class:"modal-close",onClick:s[10]||(s[10]=t=>b.value=!1)},"×")]),e("div",hs,[e("p",null,[s[37]||(s[37]=D('Вы уверены, что хотите удалить желание "',-1)),e("strong",null,d(_.value?.title),1),s[38]||(s[38]=D('"?',-1))]),s[39]||(s[39]=e("p",{class:"warning-text"},"Это действие нельзя отменить!",-1))]),e("div",ys,[e("button",{class:"btn-secondary",onClick:s[11]||(s[11]=t=>b.value=!1)},"Отмена"),e("button",{class:"btn-danger",onClick:Z},"Удалить")])])])):a("",!0),k.value?(i(),o("div",{key:3,class:"modal-overlay",onClick:s[15]||(s[15]=T(t=>k.value=!1,["self"]))},[e("div",bs,[e("div",ks,[s[40]||(s[40]=e("h2",null,"Бронирование подарка",-1)),e("button",{class:"modal-close",onClick:s[13]||(s[13]=t=>k.value=!1)},"×")]),e("div",ws,[e("p",null,[s[41]||(s[41]=D('Вы собираетесь забронировать подарок "',-1)),e("strong",null,d(C.value?.title),1),s[42]||(s[42]=D('"?',-1))]),s[43]||(s[43]=e("p",{class:"info-text"},"Другие пользователи увидят, что этот подарок уже забронирован, но автор желания не узнает, кто именно его забронировал.",-1))]),e("div",_s,[e("button",{class:"btn-secondary",onClick:s[14]||(s[14]=t=>k.value=!1)},"Отмена"),e("button",{class:"btn-primary",onClick:se},"Забронировать")])])])):a("",!0)]))}}),Es=ne(Cs,[["__scopeId","data-v-03ba5d81"]]);export{Es as default};
